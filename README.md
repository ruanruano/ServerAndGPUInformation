# ğŸŒ å¤šæœåŠ¡å™¨ç›‘æ§ç³»ç»Ÿ

æœ¬é¡¹ç›®æä¾›ä¸€ä¸ª **ç½‘é¡µå¯è§†åŒ–ç•Œé¢**ï¼Œç”¨äº **åŒæ—¶ç›‘æ§å¤šä¸ªæœåŠ¡å™¨çš„çŠ¶æ€**ï¼ˆåŒ…æ‹¬ **ç½‘ç»œã€å†…å­˜ã€ç¡¬ç›˜ã€æ˜¾å¡ç­‰ä¿¡æ¯**ï¼‰ã€‚

## ğŸ“Œ ä¸»è¦åŸç†
- **åç«¯**ï¼ˆPythonï¼‰ï¼šé€šè¿‡ SSH è¿æ¥æœåŠ¡å™¨ï¼Œå®šæœŸè·å–æ•°æ®å¹¶å­˜å‚¨åˆ°å­—å…¸ä¸­ã€‚
- **å‰ç«¯**ï¼ˆHTML + JSï¼‰ï¼šå®šæœŸä»åç«¯è·å–æ•°æ®å¹¶è¿›è¡Œå¯è§†åŒ–å±•ç¤ºã€‚

![ç¤ºä¾‹å›¾ç‰‡](pics/test.png)

---

## ğŸš€ 2. å®‰è£…

### 2.1 è¿è¡Œç¯å¢ƒ
**åç«¯ç¨‹åº** éœ€è¦ä»¥ä¸‹ç¯å¢ƒï¼Œå¯ä½¿ç”¨ Conda åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆé€‚ç”¨äº Linux å’Œ Windowsï¼‰ï¼š
```bash
pip install flask flask-cors paramiko -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

### 2.2 æœåŠ¡å™¨ç¯å¢ƒ
éœ€è¦ **ç›‘æ§çš„æœåŠ¡å™¨** éœ€è¦å®‰è£…æŸäº›å·¥å…·ï¼Œä»¥ä¾¿æ­£ç¡®è·å–æ•°æ®ï¼š

- **`ifstat`** ğŸ“¡ ï¼ˆç”¨äºè·å–ç½‘ç»œæ•°æ®ï¼‰  
  - é€šè¿‡ `apt` å®‰è£…ï¼š
    ```sh
    sudo apt install ifstat
    ```
  - **ç¡®è®¤ç½‘å¡åç§°**ï¼ˆå¦‚æœéœ€è¦æŸ¥çœ‹ç½‘ç»œæ•°æ®ï¼‰ï¼š
    ```sh
    ifstat
    ```
    **ç¤ºä¾‹è¾“å‡º**ï¼ˆæ‰¾å‡ºæœ‰æ•°æ®å˜åŒ–çš„ç½‘å¡ï¼Œå¦‚ `eno2`ï¼‰ï¼š  
    ```
        eno1                eno2          
    KB/s in  KB/s out   KB/s in  KB/s out   
        0.00      0.00      3.31      1.96  
    ```
    - åœ¨ `serverList.json` ä¸­é…ç½® `network_interface_name`ã€‚

- **`gpustat`** ğŸ® ï¼ˆç”¨äºè·å–æ˜¾å¡ä½¿ç”¨æƒ…å†µï¼‰
  - é€šè¿‡ `apt` å®‰è£…ï¼š
    ```sh
    pip install gpustat
    ```

- **NVIDIA é©±åŠ¨** ğŸš€ ï¼ˆå¦‚æœä½¿ç”¨ NVIDIA æ˜¾å¡ï¼‰
  - éœ€ç¡®ä¿ `nvidia-smi` å¯ç”¨ï¼š
    ```sh
    nvidia-smi
    ```
  - **AMD æ˜¾å¡æš‚ä¸æ”¯æŒ**ã€‚

---

### 2.3 åç«¯éƒ¨ç½²
1. **å®‰è£…ç¯å¢ƒå¹¶é…ç½®æœåŠ¡å™¨åˆ—è¡¨**
2. **è¿è¡Œåç«¯**
   ```sh
   python app.py
   ```
3. **ä¿®æ”¹ `app.py` ç›¸å…³å‚æ•°**
   ```python
   app.run(debug=False, host="0.0.0.0", port=5000)
   ```
   - `debug=False` **ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­ debug**
   - `host="0.0.0.0"` **å…è®¸å¤–éƒ¨è®¿é—®**
   - `port=5000` **æŒ‰éœ€ä¿®æ”¹**
   - ç¡®ä¿ **é˜²ç«å¢™æ”¾è¡Œç«¯å£**

4. **é…ç½®æ–‡ä»¶ `serverList.json`**
   **æ ¼å¼ç¤ºä¾‹ï¼š**
   ```json
   {
       "title": "10.1.16.216",
       "ip": "10.1.16.216",
       "port": 22,
       "username": "rzp",
       "password": "rzp",
       "key_filename": "/home/.ssh/id_rsa",
       "network_interface_name": "eno2",
       "storage_list": [
           "/media/D",
           "/media/F"
       ]
   }
   ```
   **å‚æ•°è¯´æ˜**
   - `title`ï¼šæœåŠ¡å™¨åç§°
   - `ip`ï¼šæœåŠ¡å™¨åœ°å€
   - `port`ï¼šSSH ç«¯å£ï¼ˆé»˜è®¤ `22`ï¼‰
   - `username`ï¼šSSH ç™»å½•ç”¨æˆ·å
   - `password` / `key_filename`ï¼šå¯†ç æˆ–å¯†é’¥ **ï¼ˆäºŒé€‰ä¸€ï¼‰**
   - `network_interface_name`ï¼šç½‘å¡åç§° **ï¼ˆå¯é€‰ï¼‰**
   - `storage_list`ï¼šéœ€è¦ç›‘æ§çš„ç£ç›˜è·¯å¾„ **ï¼ˆå¯é€‰ï¼‰**

ğŸ”„ **âš ï¸ `serverList.json` å˜æ›´åï¼Œéœ€è¦é‡å¯ `app.py` ç”Ÿæ•ˆï¼**

---

### 2.4 ç½‘é¡µéƒ¨ç½²
1. **ä½¿ç”¨ Docker + Nginx éƒ¨ç½²**
   ```sh
   docker run -d -p 80:80 -v /home/lxb/nginx_gpus:/usr/share/nginx/html --name nginx_gpus nginx:latest
   ```
   **å¯ä¿®æ”¹**
   ```sh
   docker run -d \
     -p <æœ¬æœºç«¯å£>:80 \
     -v <ç½‘é¡µç›®å½•>:/usr/share/nginx/html \
     --name <å®¹å™¨åç§°> \
     nginx:latest
   ```

2. **ä¿®æ”¹ `index.html`**
   - **æ›´æ”¹ `fetchData()` åœ°å€**
     ```javascript
     fetch('<åç«¯åœ°å€>/all_data')
     ```
   - **ä¿®æ”¹æ•°æ®åˆ·æ–°é—´éš”**
     ```javascript
     setInterval(fetchData, 3000); // æ¯3ç§’åˆ·æ–°ä¸€æ¬¡
     ```
     - å»ºè®® **ä¸è¦å°äº `check_interval`**ï¼Œå¦åˆ™æµªè´¹èµ„æºã€‚

3. **è®¿é—®ç½‘é¡µ**
   - ç›´æ¥è®¿é—® **`http://æœåŠ¡å™¨IP:80`**
   - æœ‰åŸŸåå¯é…ç½® **Nginx åå‘ä»£ç†** [ğŸ‘‰ é…ç½®æ•™ç¨‹](http://blog.lxblxb.top/archives/1723257245091)

---

## ğŸ¯ 3. å…¶ä»–
- **ğŸ’¡ `æ—é›„å½¬`**ï¼šæ„Ÿè°¢å­¦é•¿çš„è´¡çŒ®
- **ğŸ”§ è´¡çŒ® & åé¦ˆ**ï¼šæ¬¢è¿æäº¤ Issue / PRï¼

---

âœ… **å¦‚æœæœ‰é—®é¢˜ï¼Œæ¬¢è¿äº¤æµï¼ğŸ˜ƒ** ğŸš€
